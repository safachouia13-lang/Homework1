#include <stdio.h>
#include <stdlib.h>
#include <string.h>
//تعريف نوع Node وProduct
typedef struct Product {
    int ID;
    char Name[20];
    int Price;
} Product;
typedef struct Node {
    Product Prod;
    struct Node *next;
} Node;
//إنشاء قائمة فارغة
//للإشارة إلى أول عنصر نستخدم المؤشر head
Node* createEmptyList() {
    return NULL;
}
//فحص إن كانت القائمة فارغة
int isEmpty(Node *head) {
    return head == NULL;
}
//إدراج عنصر في بداية القائمة
//نضيف عقدة جديدة ونعدّل روابط النهاية بحيث تشير إلى العنصر الجديد كبداية//
Node* insertAtBeginning(Node *head, Product p) {
//تخصيص عقدة جديدة
    Node *newNode = (Node*) malloc(sizeof(Node));
    if (newNode == NULL) { //تحقق من نجاح التخصيص//
        printf("Memory allocation failed\n");
        exit(1);
    }
    newNode->Prod = p;// نسخ بيانات المنتج في العقدة الجديدة
    if (head == NULL) {
        newNode->next = newNode;//القائمة كانت فارغة -> العقدة الجديدة تشير لنفسها
        return newNode;// العقدة الجديدة تصبح head
    }
    Node *temp = head;
    while (temp->next != head) { //نحرك آخر حتى نصل للعقدة التي تشير للبداية
        temp = temp->next;
    }
    newNode->next = head;// الجديد يشير للبداية القديمة
    temp->next = newNode;// آخر الآن يشير للجديد (الذي صار بداية)
    head = newNode;
    return head;
}
//إدراج عنصر في نهاية القائمة الدائرية
Node* insertAtEnd(Node *head, Product p) {
    Node *newNode = (Node*) malloc(sizeof(Node));
    if (newNode == NULL) {
        printf("Memory allocation failed\n");
        exit(1);
    }
    newNode->Prod = p;
    if (head == NULL) {
        newNode->next = newNode;
        return newNode;
    }
    //إيجاد آخر عنصر (الذي يشير إلى head)//
    Node *temp = head;
    while (temp->next != head) {
        temp = temp->next;
    }
    temp->next = newNode;
    newNode->next = head;
    return head;
}
//عرض العناصر مرة واحدة فقط بدون حلقة لانهائية)//
//نستخدم do-while لنتأكد أن العنصر الأول يُطبع أيضًا قبل التوقف//
void displayList(Node *head) {
    if (head == NULL) {
        printf("The list is empty.\n");
        return;
    }
    Node *temp = head;
    do {
        printf("ID: %d | Name: %s | Price: %d\n",temp->Prod.ID, temp->Prod.Name, temp->Prod.Price);
        temp = temp->next;
    } while (temp != head); // نتوقف عندما نعود إلى البداية
}
//تحرير كل الذاكرة المستخدمة
void freeList(Node *head) {
    if (head == NULL) return;
    Node *cur = head->next;
    Node *nextNode;
    while (cur != head) {
        nextNode = cur->next;
        free(cur);
        cur = nextNode;
    }
    free(head); // نحرر العقدة الأولى أيضاً
}
int main() {
    Node *head = createEmptyList();  // نبدأ بقائمة فارغة
    p1 ={1,"milk",50};
    p2 ={2,"sugar",80};
    head = insertAtBeginning(head,p1);// إدراج في البداية//
    head = insertAtEnd(head,p2);// إدراج في النهاية//
    printf("the list:\n");
    displayList(head); // عرض الكل مرة واحدة//
    freeList(head);//تحرير الذاكرة//
    return 0;
}
